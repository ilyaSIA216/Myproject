<!DOCTYPE html>
<html lang="ru" data-color-mode="auto" data-light-theme="light" data-dark-theme="dark">
<head>
  <meta charset="utf-8" />
  <title>SiaMatch - Dating</title>

  <!-- Обязательный meta для Mini App -->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
  />

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root {
      --tg-theme-bg-color: #ffffff;
      --tg-theme-text-color: #000000;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background-color: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    h1 {
      font-size: 26px;
      margin-bottom: 8px;
    }

    #username {
      font-size: 16px;
      margin-bottom: 24px;
    }

    #mainButton {
      background-color: #0088cc;
      color: #ffffff;
      border: none;
      padding: 14px 32px;
      font-size: 17px;
      border-radius: 24px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
      margin-top: 24px;
    }

    #mainButton:active {
      background-color: #006a9c;
    }

    #profile-form {
      display: none;
      width: 100%;
      max-width: 400px;
      text-align: left;
      margin-top: 16px;
    }

    #profile-form h2 {
      font-size: 20px;
      margin-bottom: 12px;
      text-align: center;
    }

    label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
    }

    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      outline: none;
    }

    textarea {
      resize: none;
    }

    .field {
      margin-bottom: 14px;
    }

    .hint {
      font-size: 12px;
      opacity: 0.7;
      margin-top: 2px;
    }
  </style>
</head>
<body>
  <h1>Welcome to SiaMatch</h1>
  <div id="username">Loading user info...</div>

  <!-- Форма профиля -->
  <div id="profile-form">
    <h2>Ваш профиль</h2>

    <div class="field">
      <label for="age">Возраст</label>
      <input type="number" id="age" min="18" max="99" placeholder="Например, 25" required />
      <div class="hint">Только пользователи 18+</div>
    </div>

    <div class="field">
      <label for="gender">Пол</label>
      <select id="gender">
        <option value="male">Мужской</option>
        <option value="female">Женский</option>
        <option value="other">Другое</option>
      </select>
    </div>

    <div class="field">
      <label for="bio">О себе</label>
      <textarea
        id="bio"
        rows="3"
        maxlength="300"
        placeholder="Коротко расскажите о себе и кого вы ищете"
      ></textarea>
      <div class="hint">Минимум 10 символов, максимум 300</div>
    </div>
  </div>

  <button id="mainButton">Продолжить</button>

  <script>
    // Инициализация Mini App
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // Применяем тему из Telegram (тёмная/светлая и т.п.)
    const theme = Telegram.WebApp.themeParams || {};
    document.documentElement.style.setProperty(
      "--tg-theme-bg-color",
      theme.bg_color || "#ffffff"
    );
    document.documentElement.style.setProperty(
      "--tg-theme-text-color",
      theme.text_color || "#000000"
    );

    const user = Telegram.WebApp.initDataUnsafe
      ? Telegram.WebApp.initDataUnsafe.user
      : null;

    const usernameElem = document.getElementById("username");
    const profileForm = document.getElementById("profile-form");
    const mainBtn = document.getElementById("mainButton");

    // Показ имени пользователя
    if (user) {
      const name = user.first_name || user.username || "друг";
      usernameElem.textContent = `Привет, ${name}!`;
    } else {
      usernameElem.textContent = "Информация о пользователе недоступна.";
    }

    // Первый клик по кнопке — открываем форму
    mainBtn.onclick = () => {
      profileForm.style.display = "block";
      mainBtn.textContent = "Сохранить профиль";
      mainBtn.onclick = saveProfile;
    };

    function saveProfile() {
      const ageValue = Number(document.getElementById("age").value);
      const gender = document.getElementById("gender").value;
      const bio = document.getElementById("bio").value.trim();

      if (!ageValue || ageValue < 18 || ageValue > 99) {
        alert("Укажите возраст от 18 до 99 лет");
        return;
      }

      if (bio.length < 10) {
        alert("Напишите о себе хотя бы 10 символов");
        return;
      }

      const profileData = {
        tg_id: user ? user.id : null,
        first_name: user ? user.first_name : null,
        username: user ? user.username : null,
        age: ageValue,
        gender,
        bio
      };

      console.log("Profile data:", profileData);

      // Здесь позже будет запрос на бэкенд, пока просто сообщение
      alert("Профиль сохранён! В следующем шаге подключим сервер и matching.");
    }
  </script>
</body>
</html>

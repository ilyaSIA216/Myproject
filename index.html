<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiaMatch - –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .welcome-text {
            font-size: 24px;
            margin-bottom: 40px;
            text-align: center;
            font-weight: 500;
        }
        
        .app-name {
            font-size: 48px;
            font-weight: bold;
            margin: 40px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .start-btn {
            background: white;
            color: #00b09b;
            border: none;
            padding: 18px 40px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
        }
        
        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 20px;
            border: 4px solid white;
        }
        
        .steps-indicator {
            display: flex;
            gap: 10px;
            margin: 30px 0;
        }
        
        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .step-dot.active {
            background: white;
            transform: scale(1.2);
        }
        
        .step-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            margin-top: 20px;
        }
        
        .step-title {
            font-size: 24px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .input-field {
            width: 100%;
            padding: 18px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 18px;
            margin-bottom: 20px;
            outline: none;
        }
        
        .input-field:focus {
            border-color: white;
        }
        
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        select.input-field option {
            color: #333;
        }
        
        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 16px;
            border-radius: 15px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-next {
            background: white;
            color: #00b09b;
        }
        
        .btn-prev {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .btn-submit {
            background: white;
            color: #00b09b;
            width: 100%;
            padding: 18px;
            border-radius: 15px;
            border: none;
            font-size: 18px;
            font-weight: 600;
            margin-top: 20px;
            cursor: pointer;
        }
        
        .photo-upload {
            text-align: center;
            margin: 30px 0;
        }
        
        .upload-area {
            border: 3px dashed rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            padding: 40px 20px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .upload-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .photo-preview {
            width: 200px;
            height: 200px;
            border-radius: 20px;
            object-fit: cover;
            margin: 20px auto;
            display: block;
            border: 3px solid white;
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ */
        .select-wrapper {
            position: relative;
            margin-bottom: 20px;
        }
        
        .select-wrapper select {
            appearance: none;
            padding-right: 40px;
        }
        
        .select-arrow {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <!-- –®–∞–≥ 0: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div class="container" id="step-0">
        <div class="user-avatar" id="user-avatar">
            <!-- –ó–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏–∑ Telegram -->
        </div>
        
        <div class="welcome-text" id="welcome-text">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!
        </div>
        
        <div class="app-name">
            üçÄ SiaMatch
        </div>
        
        <button class="start-btn" onclick="startOnboarding()">
            –ù–∞—á–∞—Ç—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ
        </button>
    </div>
    
    <!-- –®–∞–≥ 1: –ò–º—è -->
    <div class="container hidden" id="step-1">
        <div class="steps-indicator">
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
        </div>
        
        <div class="step-container">
            <div class="step-title">–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?</div>
            
            <input type="text" 
                   class="input-field" 
                   id="name-input" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                   maxlength="30">
            
            <div class="nav-buttons">
                <button class="nav-btn btn-prev" onclick="goToStep(0)">
                    –ù–∞–∑–∞–¥
                </button>
                <button class="nav-btn btn-next" onclick="saveName()">
                    –î–∞–ª–µ–µ
                </button>
            </div>
        </div>
    </div>
    
    <!-- –®–∞–≥ 2: –í–æ–∑—Ä–∞—Å—Ç -->
    <div class="container hidden" id="step-2">
        <div class="steps-indicator">
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
        </div>
        
        <div class="step-container">
            <div class="step-title">–°–∫–æ–ª—å–∫–æ –≤–∞–º –ª–µ—Ç?</div>
            
            <div class="select-wrapper">
                <select class="input-field" id="age-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç</option>
                    <!-- –í–æ–∑—Ä–∞—Å—Ç—ã 18-60 –∑–∞–≥—Ä—É–∑—è—Ç—Å—è JavaScript -->
                </select>
                <div class="select-arrow">‚ñº</div>
            </div>
            
            <div class="nav-buttons">
                <button class="nav-btn btn-prev" onclick="goToStep(1)">
                    –ù–∞–∑–∞–¥
                </button>
                <button class="nav-btn btn-next" onclick="saveAge()">
                    –î–∞–ª–µ–µ
                </button>
            </div>
        </div>
    </div>
    
    <!-- –®–∞–≥ 3: –ì–æ—Ä–æ–¥ -->
    <div class="container hidden" id="step-3">
        <div class="steps-indicator">
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
        </div>
        
        <div class="step-container">
            <div class="step-title">–í –∫–∞–∫–æ–º –≤—ã –≥–æ—Ä–æ–¥–µ?</div>
            
            <div class="select-wrapper">
                <select class="input-field" id="city-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    <!-- –ì–æ—Ä–æ–¥–∞ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è JavaScript -->
                </select>
                <div class="select-arrow">‚ñº</div>
            </div>
            
            <div class="nav-buttons">
                <button class="nav-btn btn-prev" onclick="goToStep(2)">
                    –ù–∞–∑–∞–¥
                </button>
                <button class="nav-btn btn-next" onclick="saveCity()">
                    –î–∞–ª–µ–µ
                </button>
            </div>
        </div>
    </div>
    
    <!-- –®–∞–≥ 4: –û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ -->
    <div class="container hidden" id="step-4">
        <div class="steps-indicator">
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
        </div>
        
        <div class="step-container">
            <div class="step-title">–î–æ–±–∞–≤—å—Ç–µ –≤–∞—à–µ –ª—É—á—à–µ–µ —Ñ–æ—Ç–æ</div>
            
            <div class="photo-upload">
                <div class="upload-area" onclick="document.getElementById('main-photo-input').click()">
                    <div class="upload-icon">üì∑</div>
                    <div>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ</div>
                    <div style="font-size: 14px; opacity: 0.8; margin-top: 10px;">
                        JPEG, PNG –¥–æ 5MB
                    </div>
                </div>
                
                <img id="main-photo-preview" class="photo-preview hidden">
                
                <input type="file" 
                       id="main-photo-input" 
                       accept="image/*" 
                       class="hidden"
                       onchange="previewMainPhoto(event)">
            </div>
            
            <div class="nav-buttons">
                <button class="nav-btn btn-prev" onclick="goToStep(3)">
                    –ù–∞–∑–∞–¥
                </button>
                <button class="nav-btn btn-next" onclick="saveMainPhoto()">
                    –î–∞–ª–µ–µ
                </button>
            </div>
        </div>
    </div>
    
    <!-- –®–∞–≥ 5: –°–µ–ª—Ñ–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="container hidden" id="step-5">
        <div class="steps-indicator">
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
            <div class="step-dot active"></div>
        </div>
        
        <div class="step-container">
            <div class="step-title">–°–¥–µ–ª–∞–π—Ç–µ —Å–µ–ª—Ñ–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</div>
            
            <div style="text-align: center; margin-bottom: 25px;">
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; margin: 20px 0;">
                    <div style="font-size: 18px; margin-bottom: 10px;">üì∏ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ–ª—Ñ–∏:</div>
                    <div style="text-align: left; font-size: 14px; opacity: 0.9;">
                        ‚Ä¢ –õ–∏—Ü–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–µ—Ç–∫–æ –≤–∏–¥–Ω–æ<br>
                        ‚Ä¢ –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –º–∞—Å–æ–∫<br>
                        ‚Ä¢ –•–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ<br>
                        ‚Ä¢ –¢–æ–ª—å–∫–æ –≤—ã –≤ –∫–∞–¥—Ä–µ
                    </div>
                </div>
            </div>
            
            <div class="photo-upload">
                <div class="upload-area" onclick="document.getElementById('selfie-input').click()">
                    <div class="upload-icon">ü§≥</div>
                    <div>–°–¥–µ–ª–∞–π—Ç–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ–ª—Ñ–∏</div>
                    <div style="font-size: 14px; opacity: 0.8; margin-top: 10px;">
                        –î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏
                    </div>
                </div>
                
                <img id="selfie-preview" class="photo-preview hidden">
                
                <input type="file" 
                       id="selfie-input" 
                       accept="image/*" 
                       capture="user"
                       class="hidden"
                       onchange="previewSelfie(event)">
            </div>
            
            <div class="nav-buttons">
                <button class="nav-btn btn-prev" onclick="goToStep(4)">
                    –ù–∞–∑–∞–¥
                </button>
                <button class="nav-btn btn-next" onclick="saveSelfie()">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
                </button>
            </div>
        </div>
    </div>
    
    <!-- –®–∞–≥ 6: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö -->
    <div class="container hidden" id="step-6">
        <div class="step-container">
            <div class="loading">
                <div class="loader"></div>
                <div style="font-size: 20px; margin-top: 20px;">
                    –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ...
                </div>
            </div>
        </div>
    </div>
    
    <!-- –®–∞–≥ 7: –î–∞–Ω–Ω—ã–µ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ -->
    <div class="container hidden" id="step-7">
        <div class="step-container">
            <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 80px; margin-bottom: 30px;">‚è≥</div>
                
                <div style="font-size: 24px; font-weight: bold; margin-bottom: 20px;">
                    –î–∞–Ω–Ω—ã–µ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
                </div>
                
                <div style="font-size: 16px; line-height: 1.5; opacity: 0.9; margin-bottom: 40px;">
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–∂–∏–¥–∞–π—Ç–µ.<br>
                    –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞–π–º–µ—Ç –æ—Ç 1 –¥–æ 24 —á–∞—Å–æ–≤.<br>
                    –ú—ã –ø—Ä–∏—à–ª–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: left;">
                    <div style="font-weight: bold; margin-bottom: 10px;">–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:</div>
                    <div>‚úÖ –í–∞—à–µ —Ñ–æ—Ç–æ</div>
                    <div>‚úÖ –°–µ–ª—Ñ–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</div>
                    <div>‚úÖ –í–æ–∑—Ä–∞—Å—Ç 18+</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ========== –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        const API_URL = 'https://laughing-space-fiesta-x57vjp5qgg4rc667v-3000.app.github.dev';
        const tg = window.Telegram.WebApp;
        
        let userProfile = {
            telegramId: null,
            username: null,
            firstName: null,
            age: null,
            city: null,
            mainPhoto: null,
            selfiePhoto: null
        };
        
        // ========== –°–ü–ò–°–ö–ò –î–ê–ù–ù–´–• ==========
        const russianCities = [
            "–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥",
            "–ö–∞–∑–∞–Ω—å", "–ß–µ–ª—è–±–∏–Ω—Å–∫", "–û–º—Å–∫", "–°–∞–º–∞—Ä–∞", "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É", "–£—Ñ–∞", "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫",
            "–í–æ—Ä–æ–Ω–µ–∂", "–ü–µ—Ä–º—å", "–í–æ–ª–≥–æ–≥—Ä–∞–¥", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–°–∞—Ä–∞—Ç–æ–≤", "–¢—é–º–µ–Ω—å", "–¢–æ–ª—å—è—Ç—Ç–∏",
            "–ò–∂–µ–≤—Å–∫", "–ë–∞—Ä–Ω–∞—É–ª", "–£–ª—å—è–Ω–æ–≤—Å–∫", "–ò—Ä–∫—É—Ç—Å–∫", "–•–∞–±–∞—Ä–æ–≤—Å–∫", "–Ø—Ä–æ—Å–ª–∞–≤–ª—å",
            "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫", "–ú–∞—Ö–∞—á–∫–∞–ª–∞", "–¢–æ–º—Å–∫", "–û—Ä–µ–Ω–±—É—Ä–≥", "–ö–µ–º–µ—Ä–æ–≤–æ", "–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫",
            "–†—è–∑–∞–Ω—å", "–ê—Å—Ç—Ä–∞—Ö–∞–Ω—å", "–ù–∞–±–µ—Ä–µ–∂–Ω—ã–µ –ß–µ–ª–Ω—ã", "–ü–µ–Ω–∑–∞", "–ö–∏—Ä–æ–≤", "–õ–∏–ø–µ—Ü–∫",
            "–ß–µ–±–æ–∫—Å–∞—Ä—ã", "–ë–∞–ª–∞—à–∏—Ö–∞", "–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥", "–¢—É–ª–∞", "–ö—É—Ä—Å–∫", "–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å",
            "–°–æ—á–∏", "–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫", "–¢–≤–µ—Ä—å", "–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å", "–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å", "–ò–≤–∞–Ω–æ–≤–æ",
            "–ë—Ä—è–Ω—Å–∫", "–ë–µ–ª–≥–æ—Ä–æ–¥", "–°—É—Ä–≥—É—Ç", "–í–ª–∞–¥–∏–º–∏—Ä", "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫", "–ö–∞–ª—É–≥–∞",
            "–°–º–æ–ª–µ–Ω—Å–∫", "–Ø–∫—É—Ç—Å–∫", "–°–∞—Ä–∞–Ω—Å–∫", "–ß–∏—Ç–∞", "–ì—Ä–æ–∑–Ω—ã–π", "–í–æ–ª–∂—Å–∫–∏–π", "–ß–µ—Ä–µ–ø–æ–≤–µ—Ü",
            "–í–ª–∞–¥–∏–∫–∞–≤–∫–∞–∑", "–ú—É—Ä–º–∞–Ω—Å–∫", "–ö—É—Ä–≥–∞–Ω", "–°—Ç–µ—Ä–ª–∏—Ç–∞–º–∞–∫", "–û—Ä—ë–ª", "–í–æ–ª–æ–≥–¥–∞",
            "–°–∞–ª–µ—Ö–∞—Ä–¥", "–ß—É–∫–æ—Ç—Å–∫–∏–π –ê–û", "–ï–≤—Ä–µ–π—Å–∫–∞—è –ê–û"
        ].sort((a, b) => a.localeCompare(b, 'ru'));
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        async function initApp() {
            try {
                // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
                tg.expand();
                tg.ready();
                
                // 2. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const tgUser = tg.initDataUnsafe?.user;
                if (!tgUser) {
                    alert('–û—à–∏–±–∫–∞: –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞');
                    return;
                }
                
                // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ Telegram
                userProfile.telegramId = tgUser.id;
                userProfile.username = tgUser.username || '';
                
                // 4. –ï—Å–ª–∏ –µ—Å—Ç—å –∏–º—è –≤ Telegram - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
                if (tgUser.first_name) {
                    userProfile.firstName = tgUser.first_name;
                    document.getElementById('name-input').value = tgUser.firstName;
                }
                
                // 5. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                displayWelcome(tgUser);
                
                // 6. –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–∫–∏
                populateAgeSelect();
                populateCitySelect();
                
                console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            }
        }
        
        function displayWelcome(tgUser) {
            const welcomeText = document.getElementById('welcome-text');
            const userAvatar = document.getElementById('user-avatar');
            
            // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–º–µ–Ω–µ–º
            if (tgUser.first_name) {
                welcomeText.textContent = `–ü—Ä–∏–≤–µ—Ç, ${tgUser.first_name}!`;
            }
            
            // –ê–≤–∞—Ç–∞—Ä (–ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∏–º–µ–Ω–∏ –∏–ª–∏ —ç–º–æ–¥–∑–∏)
            if (tgUser.first_name) {
                userAvatar.textContent = tgUser.first_name.charAt(0).toUpperCase();
            } else {
                userAvatar.textContent = 'üë§';
            }
        }
        
        function populateAgeSelect() {
            const select = document.getElementById('age-select');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç</option>';
            
            for (let age = 18; age <= 60; age++) {
                const option = document.createElement('option');
                option.value = age;
                option.textContent = `${age} –ª–µ—Ç`;
                select.appendChild(option);
            }
        }
        
        function populateCitySelect() {
            const select = document.getElementById('city-select');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
            
            russianCities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                select.appendChild(option);
            });
        }
        
        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==========
        function goToStep(stepNumber) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —à–∞–≥–∏
            for (let i = 0; i <= 7; i++) {
                document.getElementById(`step-${i}`).classList.add('hidden');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —à–∞–≥
            document.getElementById(`step-${stepNumber}`).classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            updateProgressIndicator(stepNumber);
        }
        
        function updateProgressIndicator(currentStep) {
            if (currentStep < 1 || currentStep > 5) return;
            
            const indicators = document.querySelectorAll('.step-dot');
            indicators.forEach((dot, index) => {
                if (index < currentStep) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }
        
        function startOnboarding() {
            goToStep(1);
        }
        
        // ========== –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• ==========
        function saveName() {
            const name = document.getElementById('name-input').value.trim();
            
            if (!name) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
                return;
            }
            
            if (name.length < 2) {
                tg.showAlert('–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
                return;
            }
            
            userProfile.firstName = name;
            goToStep(2);
        }
        
        function saveAge() {
            const age = parseInt(document.getElementById('age-select').value);
            
            if (!age || age < 18 || age > 60) {
                tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç –æ—Ç 18 –¥–æ 60 –ª–µ—Ç');
                return;
            }
            
            userProfile.age = age;
            goToStep(3);
        }
        
        function saveCity() {
            const city = document.getElementById('city-select').value;
            
            if (!city) {
                tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –≥–æ—Ä–æ–¥');
                return;
            }
            
            userProfile.city = city;
            goToStep(4);
        }
        
        // ========== –†–ê–ë–û–¢–ê –° –§–û–¢–û ==========
        function previewMainPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (5MB)
            if (file.size > 5 * 1024 * 1024) {
                tg.showAlert('–§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 5MB');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
            if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                tg.showAlert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ JPEG –∏–ª–∏ PNG —Ñ–∞–π–ª');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('main-photo-preview');
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ
                userProfile.mainPhoto = e.target.result;
            };
            
            reader.readAsDataURL(file);
        }
        
        function previewSelfie(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (5MB)
            if (file.size > 5 * 1024 * 1024) {
                tg.showAlert('–§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('selfie-preview');
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ
                userProfile.selfiePhoto = e.target.result;
            };
            
            reader.readAsDataURL(file);
        }
        
        function saveMainPhoto() {
            if (!userProfile.mainPhoto) {
                tg.showAlert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–µ —Ñ–æ—Ç–æ');
                return;
            }
            
            goToStep(5);
        }
        
        async function saveSelfie() {
            if (!userProfile.selfiePhoto) {
                tg.showAlert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ–ª—Ñ–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
                return;
            }
            
            goToStep(6);
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                await sendRegistrationData();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('sia_match_profile', JSON.stringify({
                    ...userProfile,
                    status: 'pending',
                    registeredAt: new Date().toISOString()
                }));
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —ç–∫—Ä–∞–Ω—É –æ–∂–∏–¥–∞–Ω–∏—è
                setTimeout(() => {
                    goToStep(7);
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                goToStep(5);
            }
        }
        
        // ========== –û–¢–ü–†–ê–í–ö–ê –ù–ê –°–ï–†–í–ï–† ==========
        async function sendRegistrationData() {
            try {
                console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
                
                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                const registrationData = {
                    telegramId: userProfile.telegramId,
                    username: userProfile.username,
                    firstName: userProfile.firstName,
                    age: userProfile.age,
                    city: userProfile.city,
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ñ–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
                    hasPhoto: !!userProfile.mainPhoto,
                    hasSelfie: !!userProfile.selfiePhoto
                };
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –≤–∞—à –±—ç–∫–µ–Ω–¥
                const response = await fetch(`${API_URL}/api/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(registrationData)
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã:', result);
                return result;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                throw error;
            }
        }
        
        // ========== –ó–ê–ü–£–°–ö ==========
        document.addEventListener('DOMContentLoaded', initApp);
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        window.startOnboarding = startOnboarding;
        window.goToStep = goToStep;
        window.saveName = saveName;
        window.saveAge = saveAge;
        window.saveCity = saveCity;
        window.saveMainPhoto = saveMainPhoto;
        window.saveSelfie = saveSelfie;
        window.previewMainPhoto = previewMainPhoto;
        window.previewSelfie = previewSelfie;
    </script>
</body>
</html>

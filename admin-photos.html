<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiaMatch - –ê–¥–º–∏–Ω —Å —Ñ–æ—Ç–æ</title>
    <style>
        /* –¢–µ –∂–µ —Å—Ç–∏–ª–∏ —á—Ç–æ –∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏, –Ω–æ –¥–æ–±–∞–≤—å—Ç–µ: */
        .photo-section {
            margin: 15px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .photo-item {
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        .photo-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .photo-label {
            padding: 10px;
            text-align: center;
            background: #f5f5f5;
            font-size: 14px;
        }
        .no-photo {
            padding: 30px;
            text-align: center;
            color: #888;
            font-style: italic;
        }
        .photo-warning {
            background: #FFF3CD;
            border: 1px solid #FFEAA7;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
    <div class="container">
        <div id="admin-container">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞... -->
        </div>
    </div>

    <script>
        // –î–û–ë–ê–í–¨–¢–ï –≠–¢–ò –§–£–ù–ö–¶–ò–ò –í –í–ê–® –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –°–ö–†–ò–ü–¢ –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
        
        function loadApplicationWithPhotos(application) {
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –¥–µ—Ç–∞–ª–µ–π –∑–∞—è–≤–∫–∏
            
            let photoHTML = '';
            
            // –û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ
            if (application.hasMainPhoto || application.mainPhoto) {
                photoHTML += `
                    <div class="photo-section">
                        <h4>üì∑ –û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ:</h4>
                        ${application.mainPhoto && application.mainPhoto.startsWith('http') ? `
                            <div class="photo-item">
                                <img src="${application.mainPhoto}" alt="–û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ" 
                                     onclick="showLargePhoto('${application.mainPhoto}')">
                                <div class="photo-label">–û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ</div>
                            </div>
                        ` : application.mainPhoto && application.mainPhoto.startsWith('data:image') ? `
                            <div class="photo-item">
                                <img src="${application.mainPhoto.substring(0, 100)}..." alt="–§–æ—Ç–æ (base64)" 
                                     onclick="showBase64Warning()">
                                <div class="photo-label">–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ (base64)</div>
                            </div>
                            <div class="photo-warning">
                                ‚ö†Ô∏è –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–∞–∫ base64. –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:
                                <button onclick="tryToLoadPhoto(${application.id}, 'main')">
                                    –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å
                                </button>
                            </div>
                        ` : `
                            <div class="no-photo">
                                üì∑ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–æ—Ç–æ, –Ω–æ –æ–Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å
                                <br><small>–í–æ–∑–º–æ–∂–Ω–æ, —Ñ–æ—Ç–æ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º</small>
                            </div>
                        `}
                    </div>
                `;
            }
            
            // –°–µ–ª—Ñ–∏
            if (application.hasSelfie || application.selfie) {
                photoHTML += `
                    <div class="photo-section">
                        <h4>ü§≥ –°–µ–ª—Ñ–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</h4>
                        ${application.selfie && application.selfie.startsWith('http') ? `
                            <div class="photo-item">
                                <img src="${application.selfie}" alt="–°–µ–ª—Ñ–∏" 
                                     onclick="showLargePhoto('${application.selfie}')">
                                <div class="photo-label">–°–µ–ª—Ñ–∏</div>
                            </div>
                        ` : application.selfie && application.selfie.startsWith('data:image') ? `
                            <div class="photo-item">
                                <img src="${application.selfie.substring(0, 100)}..." alt="–°–µ–ª—Ñ–∏ (base64)">
                                <div class="photo-label">–°–µ–ª—Ñ–∏ (base64)</div>
                            </div>
                            <div class="photo-warning">
                                ‚ö†Ô∏è –°–µ–ª—Ñ–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–∞–∫ base64
                                <button onclick="tryToLoadPhoto(${application.id}, 'selfie')">
                                    –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å
                                </button>
                            </div>
                        ` : `
                            <div class="no-photo">
                                ü§≥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∏–ª —Å–µ–ª—Ñ–∏, –Ω–æ –æ–Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å
                                <br><small>–í–æ–∑–º–æ–∂–Ω–æ, —Ñ–æ—Ç–æ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º</small>
                            </div>
                        `}
                    </div>
                `;
            }
            
            return photoHTML;
        }
        
        function showLargePhoto(url) {
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                cursor: pointer;
            `;
            
            modal.innerHTML = `
                <img src="${url}" style="max-width: 90%; max-height: 90%; object-fit: contain;">
                <div style="position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer;">
                    √ó
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.onclick = function() {
                document.body.removeChild(modal);
            };
        }
        
        function showBase64Warning() {
            alert('‚ö†Ô∏è –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64 –∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.\n\n' +
                  '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n' +
                  '1. –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–æ—Ç–æ\n' +
                  '2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∂–∞—Ç–∏–µ —Ñ–æ—Ç–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π\n' +
                  '3. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ –≤ —á–∞—Ç');
        }
        
        function tryToLoadPhoto(userId, photoType) {
            if (typeof loadPhoto === 'function') {
                const photo = loadPhoto(userId, photoType);
                if (photo) {
                    showLargePhoto(photo);
                } else {
                    alert('‚ùå –§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ');
                }
            } else {
                alert('‚ùå –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
            }
        }
        
        // –í —Ñ—É–Ω–∫—Ü–∏–∏ viewApplicationDetails –î–û–ë–ê–í–¨–¢–ï:
        function viewApplicationDetails(userId) {
            let applications = [];
            try {
                const stored = localStorage.getItem('sia_pending_users');
                if (stored) {
                    applications = JSON.parse(stored);
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞:', e);
            }
            
            const app = applications.find(u => u.id === userId);
            if (app) {
                let details = `üìã –ó–ê–Ø–í–ö–ê #${app.applicationId || app.id}\n\n`;
                details += `üë§ –ò–º—è: ${app.name}\n`;
                details += `üéÇ –í–æ–∑—Ä–∞—Å—Ç: ${app.age} –ª–µ—Ç\n`;
                details += `üë´ –ü–æ–ª: ${app.gender === 'male' ? '–ú—É–∂—á–∏–Ω–∞' : '–ñ–µ–Ω—â–∏–Ω–∞'}\n`;
                details += `üèôÔ∏è –ì–æ—Ä–æ–¥: ${app.city}\n`;
                details += `üìÖ –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏: ${new Date(app.submittedAt).toLocaleString()}\n`;
                details += `üìä –°—Ç–∞—Ç—É—Å: ${getStatusText(app.status)}\n`;
                
                if (app.bio) details += `\nüìù –û–ø–∏—Å–∞–Ω–∏–µ:\n${app.bio}\n`;
                
                // –î–û–ë–ê–í–õ–Ø–ï–ú –ò–ù–§–û–†–ú–ê–¶–ò–Æ –û –§–û–¢–û
                if (app.hasMainPhoto || app.mainPhoto) {
                    details += `\nüì∑ –û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ: ${app.mainPhoto ? '–µ—Å—Ç—å' : '–∑–∞–≥—Ä—É–∂–µ–Ω–æ'}\n`;
                }
                if (app.hasSelfie || app.selfie) {
                    details += `ü§≥ –°–µ–ª—Ñ–∏: ${app.selfie ? '–µ—Å—Ç—å' : '–∑–∞–≥—Ä—É–∂–µ–Ω–æ'}\n`;
                }
                
                // –ü–û–ö–ê–ó–´–í–ê–ï–ú –û–ö–ù–û –° –§–û–¢–û
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;
                
                modal.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 10px; max-width: 90%; max-height: 90%; overflow-y: auto;">
                        <h3>${app.name}, ${app.age} –ª–µ—Ç</h3>
                        <pre style="white-space: pre-wrap; font-family: inherit;">${details}</pre>
                        
                        ${loadApplicationWithPhotos(app)}
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                    style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
            } else {
                alert('–ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        }
    </script>
</body>
</html>
